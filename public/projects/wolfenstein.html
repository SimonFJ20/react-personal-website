
<h1>
    3D Rendering
</h1>

<h2>
    3D rendering ligesom Wolfenstein
</h2>

<h4>
    C++, JavaScript
</h4>


<p>
    Jeg havde fri en weekend, så jeg eksperimenterede med
    3D rendering, ligesom det gamle Wolfenstein spil.
</p>

<p><i>Her ses et screenshot af version 3</i></p>
<img src="https://github.com/SimonFJ20/3dWolfensteinRendering/blob/main/version%203/screenshot.PNG?raw=true" alt="Screenshot af version 3">
<i class="img">Klik og hold nede for at zoome.</i>

<h2>
    Intro
</h2>

<p>
    Det startede med en fredag aften. Jeg sad og skrev med min ven, og ligepludselig kom samtalen
    hen på 3D rendering. Og så kom udfordringen: <b>Du kan ikke lave en rasterizer fra scratch (fra bunden)</b>.
    Og lidt som en joke tilføjede jeg: <b>Jo, og jeg kan lave den i Scratch (MIT Scratch)</b>
</p>


<h2>
    Fra scratch i Scratch
</h2>

<p>
    Hvad er:
    <br>
    <b>En rasterizer</b> er et program som laver definerede former og figurer, kaldet vektor grafik,
    om til pixel i et raster billede. Raster billeder kan man, ligesom i mit tilfælde, vise på en computerskærm.
    <br><br>
    <b>MIT Scratch</b> er platform til at lave og spille simple spil. Scratch er lavet af Massachusetts Institute of Technology (MIT)
    til at lærer børn og unge om computerlogisk tankegang og at skabe interresse i computere. Til det er Scratch meget godt,
    det har bare nogle seriøse ulemper, når det kommer til mere advancerede programmer.
</p>

<p>
    Jeg startede projektet med at studere en video jeg havde set på en anden lejlighed. 
    <br>
    <iframe width="100%" height="430" src="https://www.youtube.com/embed/xW8skO7MFYw" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    <br>
    Videon er lavet af <a href="https://www.youtube.com/channel/UC-yuWVUplUJZvieEligKBkA" target="blank">
        One Lone Coder aka. javidx9</a>
    og er en 40 minutters tutorial om hvordan man laver rasterizer i C++. Jeg skulle mest bruge videoen til at finde
    ud af matematikken, da den er lidt svær.
    <br><br>
    javidx9 har lavet mange videoer, hvor han laver og forklare små spil og andre hobby projekter, programmeret i C++.
</p>

<p>
    Så jeg gik i gang i Scratch, og efter 4-5 timers hårdt arbejde have jeg opnået... jaaa... ikke ret meget.
    Jeg have lavet en tilfældig autogenereret 2D bane, og kun lige begyndt på ray casting og 3d.
</p>

<img src="/static/wolfenstein1.PNG" alt="Fuld billede af MIT Scratch">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein2.PNG" alt="Billede af 4 tilfældige baner">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein3.PNG" alt="Billede af Scratch koden">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein4.PNG" alt="Billede af Scratch der crashede">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Jeg havde på dette tidspunkt konkluderet at Scratch ikke kun var langsomt, men også irriterende og dybt
    antiproduktivt. Jeg gav ikke helt op, men jeg var DONE med Scratch. I hvert fald for nu.
</p>

<h2>
    Ctrl-C++ Ctrl-V
</h2>

<p>
    Efter en ordenlig gennemtænkning og noget nattesøvn, havde jeg lagt en ny plan. Jeg ville starte med
    at følge videoen trin for trin, så jeg forstod hver enkelt linje kode. Jeg ville også gøre det i det
    samme programmeringssprog, som han bruger i videoen: <b>C++</b>.
    <br><br>
    For folk som ikke kender så meget til programmeringssprog, så er der forskel på sværdhedsgraden af 
    forskellige sprog. Fx er Scratch meget nemt og er lavet til at børn vil kunn forstå det.
    JavaScript og Python er lavet til at alle med grundlæggende viden for programmering vil kunne forstå
    og bruge det. Og så er der C++. Som citeret af designeren, Bjarne Stroustrup: "C++ is made to be a 
    professional tool for professionals.". Som du nok kan regne ud er C++ lidt svært. Man kan sammenligne
    det lidt med det tyske sprog, utrolig mange regler og endnu flere faldgrupper.
</p>

<p>
    Men for at kunne lave det i C++ var jeg nød til at åbne mit "yndlings"-program Visual Studio. Det er
    langsommere end en 2CV og mere uoverskueligt end en tabt spand maling. Det er fyldt med menu'er og
    andre features man aldrig bruger.
    <br><br>
    Men efter ca. 2 timer havde jeg et fungerende program.
</p>

<img src="/static/wolfenstein5.PNG" alt="Billede af Visual Studio der starter">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein6.PNG" alt="Billede af Visual Studio der er uoverskueligt">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="https://raw.githubusercontent.com/SimonFJ20/3dWolfensteinRendering/main/version%20cpp/screenshot.PNG" alt="Billede af rasterizer">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Ud over det forventede gik det rimeligt smertefrit, så nu havde jeg en virkende version af programmet.
    Der er bare en anden hage ved C++, det er at det er næsten umuligt at distribuere. Med mindre man vil
    have at brugeren af programmet skal downloade en installer wizard med den rigtige version og 
    installere programmet permanent,
    eller man vil have folk skal downloade kildekoden og selv kompilerer, så er C++ ikke det mest praktiske
    sprog i verden. En bedre ide er at lave programmet i JavaScript og have det på en hjemmeside istedet. 
    Hjemmesider er så standardiserede
    at alle webbrowsere (med undtagelse af gamle IE versioner) kan vise alle hjemmesider. Og siden alle
    elektroniske devices nu om dage kan gå på nettet, vil distribuering ikke være et problem. Der er dog det
    at C++ er mindst 10 gange hurtigere end JavaScript på hele feltet. Men det går nok.
    <a href="https://github.com/SimonFJ20/3dWolfensteinRendering/blob/main/version%20cpp/Main.cpp" target="blank">
        Du kan se koden her.</a>
</p>



<h2>
    Version 1: Direkte konvertering
</h2>

<p>
    Jeg startede med at gå linje for linje og konvertere det fra C++ til JavaScript. Der er et par forskelle
    på JavaScript og C++, men der er også mange ligeheder. Derfor er det relativt nemt at konvertere det fra
    det ene til det andet.
    <br><br>
    Der er nogle steder hvor man er nød til at finde en anden vej rundt. Fx kommunikere C++ programmet direkte
    med windows, og det kan man ikke i JavaScript. Der er man istedet fastlåst til browseren på godt og ondt.
    Så jeg har lavet 2 filer:
    <br><br>
    <b>main.js</b> indeholder selve programmet.
    <br><br>
    <b>util.js</b> indeholder alt kommunikation mellem programmet og browseren. Og så indeholder den forskellige
    funktioner til at emulere det C++ specifikke kode.
    <br><br>
    Jeg har lige et eksempel på noget C++ specifikt kode som er konverteret til JavaScript:
</p>

<img src="/static/wolfenstein7.PNG" alt="Main.cpp">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein8.PNG" alt="main.js">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein9.PNG" alt="util.js">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    <a href="https://gist.github.com/SimonFJ20/453c560eb931834e16ce9a9933b53990" target="blank">
        Sammenlign på GitHub
    </a>
    <br>
    <a href="https://github.com/SimonFJ20/3dWolfensteinRendering/blob/33f16c9156c10c0591d08907a890e2273b84f04f/version%20cpp/Main.cpp#L136-L154" target="blank">
        Se Main.cpp
    </a>
    &nbsp;&nbsp;
    <a href="https://github.com/SimonFJ20/3dWolfensteinRendering/blob/33f16c9156c10c0591d08907a890e2273b84f04f/version%201/main.js#L120-L138" target="blank">
        Se main.js
    </a>
    &nbsp;&nbsp;
    <a href="https://github.com/SimonFJ20/3dWolfensteinRendering/blob/33f16c9156c10c0591d08907a890e2273b84f04f/version%201/util.js#L46-L77" target="blank">
        Se util.js
    </a>
    <br>
    Som du nok kan se, er koden i C++ lidt utydelig og ser meget kompliceret ud. Det er noget
    man meget gerne skulle forsøge at undgå. 
    <br><br>
    Kort forklaret, så regner koden hvor hvert hjørne
    af en firkan er, i forhold med distance til spilleren. Så laver den fire par. Hvert par
    representere et hjørne. Hvert par består af distancen fra hjørnet til spilleren, og 
    prikproduktet af hjørnets vektor og spillerens øjevektor. Derefter sortere den de fire
    par. Og siger derefter at den skal vise de 2 hjørner tættest på spilleren.
    <br><br>
    Jeg ved godt det lyder lidt indviklet. Og implementeringen i JavaScript er lavet, så den
    refererer til en meget lang kommenter der i tekniske detaljer forklare hvad der sker.
    Det er også noget man meget gerne skulle forsøge at undgå.
    <br><br>
    Men nu har jeg en fungerende program i JavaScript, som er en komplet klon af det originale C++.
    Med grøn farve, fordi det ser godt ud.
</p>

<img src="https://raw.githubusercontent.com/SimonFJ20/3dWolfensteinRendering/main/version%201/screenshot.PNG" alt="Billede af verion 1">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Men jeg var ikke helt tilfreds med denne version, fx. det kode vi kiggede på. Så derfor
    lavede jeg også
</p>

<h2>
    Version 2: Små forbedringer
</h2>

<p>
    Det først jeg gjorde var at omdøbe mine variabler til noget som passer min stil af programmering
    lidt bedre. Fx er variablerne 'fPlayerA' omdøbet til 'playerAngle'. Jeg har også gjort det nogles
    steder for at gøre navnene lidt mere beskrivende. Fx er 'tp1' og 'tp2' blevet til 'now' og 'before'
    hvilket giver bedre mening i konteksten.
    <br><br>
    Det næste jeg gjorde var at omskrive noget af koden af forskellige grunde.
    <br><br>
    Så gik jeg igenmmen alt koden igen, og lavede uddybende kommentare, hvor det var nødvendigt.
    <br><br>
    Og så tilføjede jeg en pil på kortet i hjørnet, så man kan se hvilken retning man peger. Min første
    ide var at have 8 pilsymboler: ↓↘→↗↑↖←↙, og så vise den der passede bedst i forhold til spillerens
    rotation. Men fordi der kun er 8 symboler og symbolerne har forskellige højder og derved forskydder
    en række på skærmen, valgte jeg en anden ide.
    <br>
    Den anden ide gik ud på at få browseren til at rotere den. Med hjælp fra CSS og et trick der hedder
    'transform: rotate()' kan jeg fortælle browseren at et object skal roteres til en bestemt vinkel, 
    når den bliver vist. Og så sætter jeg bare pilens rotation til pilens rotation.
    <br>
    Begge løsninger var inspireret af min ven Theis Pieter. Du kan se hans personlige hjemmeside her:
    <a href="https://tphollebeek.netlify.app" target="_blank" >tphollebeek.netlify.app</a>
    <br>
    Og begge løsninger står stadig i koden, den ene er bare kommenteret ud.
</p>

<img src="https://raw.githubusercontent.com/SimonFJ20/3dWolfensteinRendering/main/version%202/screenshot.PNG" alt="Billede af version 2 og pil">
<i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein10.PNG" alt="Billede af kode">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Jeg har igen reviseret eksemplet fra tidligere.
    Jeg havde fundet ud af at den måde jeg gjorde det på før ikke virkede som den skulle.
    Så jeg omskrev den, så den virkede og så den var skrevet som JavaScript og ikke som emuleret
    C++.
    <br><br>
    Den tidligere version sorterede ikke hele arrayet, kun første og sidste element. Den nye version
    ser sådanne ud:
</p>

<img src="/static/wolfenstein11.PNG" alt="Billede af kode">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Nu står det hele sammen i <b>main.js</b>. Den inkluderer også en sortingsalgoritme der hedder
    'selection sort' som du kan læse om her:
    <a href="https://en.wikipedia.org/wiki/Selection_sort" target="blank">
        Wikipedia - Selection sort
    </a>.
    Det er også der jeg har selve sortingskoden fra.
    <br><br>
</p>

<p>
    Nå, men målet var jo at lave noget Wolfenstein lignende grafik.
    Og her er to billeder til sammenligning:
</p>

<img src="https://www.sapphirenation.net/-/media/sites/sapphirenation/articles/2017/09/Wolf-3d-gameplay.jpg" alt="Billede af klassisk Wolfenstein">
<br><i class="img">Klik og hold nede for at zoome.</i>

<img src="https://raw.githubusercontent.com/SimonFJ20/3dWolfensteinRendering/main/version%202/screenshot.PNG" alt="Billede af version 2 og pil">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Som du kan se minder vægene lidt om hinanden. Men vi mangler jo både farver
    og nazister. Derfor lavede jeg
</p>

<h2>
    Version 3: Bedre grafik
</h2>

<p>
    Denne version var, omvendt hvad man ville tro, den nemmeste version at lave. Alt koden er jo skrevet.
    Så det eneste jeg skulle gøre, var at omskrive <b>util.js</b> så den outputter til et HTML Canvas
    istedet for ren tekst. Det var egentlig meget nemt, da jeg har meget erfaring med 2D grafik i JavaScript.
    Det andet jeg skulle gøre var at ændre spillets opløsning fra 120x40 til 1280x720. Og så virkede det
    strålede..... med 2 FPS. Det hakkede meget, så næste step var at optimere koden.
    <br><br>
    Jeg startede med at ændre opløsning fra den reelle 1280x720 til 640x360 med 2x2 størrelse pixels. Det
    fik FPS helt op på 7. Og så eksperiementerede jeg med hvor nøjagtigt den måler længden til vægen. Det
    blev resultatet ikke bedre af, så jeg ændrede det tilbage.
    <br><br>
    Siden koden var lavet til text, var farveskiftene meget hårde, så det var det næste jeg lavede om på.
    Og min løsning var et eksempel på de løsninger der samtidig med at tilføje mere, også laver koden mindre,
    og mere læselig. Her er version 2 og 3 til sammenligning
</p>

<img src="/static/wolfenstein12.PNG" alt="Billede af kode">
<br><i class="img">Klik og hold nede for at zoome.</i>

<img src="/static/wolfenstein13.PNG" alt="Billede af kode">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Så manglede jeg bare at tegne kortet, og de fire værdier på skærmen. Det er også en af de nemmere
    opgaver som browseren gør for en. Dog er der ikke en pil på denne version, da jeg nu havde brugt
    størstedelen af min weekend på projektet, havde jeg ikke lyst til at implementere det.
    <br><br>
    Her er resultatet:
</p>

<img src="https://raw.githubusercontent.com/SimonFJ20/3dWolfensteinRendering/main/version%203/screenshot.PNG" alt="Screenshot af version 3">
<i class="img">Klik og hold nede for at zoome.</i>

<p>
    Det ligner næsten Wolfenstein, hvis man ser bort fra Nazisterne, eller mangel deraf. Men hvis
    man ville kunne man, med lidt optimering, udbygge koden til et fuldt spil med både skyddere
    og bad guys. Men det var ikke mit mål. Mit mål var bare at lave en rasterizer, og det lykkedes,
    dog ikke i Scratch, men det lykkedes.
    <br><br>
    Siden billederne gør et dårligt arbejde af at vise spillet er du velkommen til at prøve dem her:
    <br>
    <a href="/static/wolfenstein/version-1/index.html" target="blank">
        Version 1
    </a>
    <br>
    <a href="/static/wolfenstein/version-2/index.html" target="blank">
        Version 2
    </a>
    <br>
    <a href="/static/wolfenstein/version-3/index.html" target="blank">
        Version 3
    </a>
    <br><br>
    Ellers kan du se alle filerne på GitHub, sammen med en EXE til C++ versionen:
    <br>
    <a href="https://github.com/SimonFJ20/3dWolfensteinRendering" target="blank">
        GitHub.com/SimonFJ20/3dWolfensteinRendering
    </a>
    <br><br>
    Så kan du læse lidt om min ven Theis Pieter:
    <br>
    <a href="https://tphollebeek.netlify.app" target="_blank" >
        tphollebeek.netlify.app
    </a>
    <br><br>
    Og så kan du se videoen der inspirerede mig til at lave projektet:
    <br>
    <a href="https://www.youtube.com/embed/xW8skO7MFYw" target="blank">
        Code-It-Yourself! First Person Shooter (Quick and Simple C++)
    </a>
    <br>
    Af:
    <br>
    <a href="https://www.youtube.com/channel/UC-yuWVUplUJZvieEligKBkA" target="blank">
        One Lone Code aka. javidx9
    </a>
</p>
